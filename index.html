<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FRUTI TECH">
    <meta name="theme-color" content="#FF6B6B">
    <meta name="description" content="Sistema de gesti√≥n de ventas para negocios de jugos y frutas">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS Icons -->
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192x192.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-72x72.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-72x72.png">
    
    <title>üçπ FRUTI TECH</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', cursive;
            background: linear-gradient(135deg, #FFFEF7 0%, #FFE5E5 100%);
            overflow-x: hidden;
            position: fixed;
            width: 100%;
            height: 100vh;
        }

        /* VISTA: PRODUCTOS */
        .vista-productos {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 10px;
        }

        .header {
            text-align: center;
            padding: 20px 15px;
            background: linear-gradient(135deg, #FF6B6B 0%, #FF9800 100%);
            border-radius: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
            flex-shrink: 0;
        }

        .logo-container {
            width: 80px;
            height: 80px;
            margin: 0 auto 10px;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid white;
            background: white;
        }

        .logo-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .logo-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }

        h1 {
            color: white;
            font-size: 32px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin: 0;
        }

        .productos-container {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 10px;
        }

        .producto-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 3px solid transparent;
            transition: all 0.2s;
        }

        .producto-card:active {
            transform: scale(0.98);
            border-color: #FF6B6B;
        }

        .producto-imagen {
            width: 100%;
            height: 180px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #FFD93D 0%, #FF9800 100%);
        }

        .producto-imagen img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .producto-emoji {
            font-size: 100px;
            text-align: center;
            line-height: 180px;
        }

        .producto-info {
            text-align: center;
        }

        .producto-nombre {
            font-size: 28px;
            color: #2C3E50;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .producto-precio {
            font-size: 42px;
            color: #FF6B6B;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .btn-agregar {
            width: 100%;
            padding: 25px;
            font-size: 32px;
            font-weight: bold;
            background: linear-gradient(135deg, #6BCF7F 0%, #4ECDC4 100%);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(76, 205, 196, 0.3);
            font-family: 'Comic Sans MS', cursive;
            touch-action: manipulation;
        }

        .btn-agregar:active {
            transform: scale(0.95);
            box-shadow: 0 2px 8px rgba(76, 205, 196, 0.3);
        }

        .btn-ver-carrito {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #FF6B6B 0%, #FF1744 100%);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 40px;
            box-shadow: 0 8px 25px rgba(255, 23, 68, 0.5);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }

        .btn-ver-carrito:active {
            transform: scale(0.9);
        }

        .carrito-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #FFD93D;
            color: #2C3E50;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            border: 3px solid white;
        }

        /* VISTA: CARRITO */
        .vista-carrito {
            display: none;
            flex-direction: column;
            height: 100vh;
            padding: 10px;
            background: white;
        }

        .vista-carrito.activa {
            display: flex;
        }

        .carrito-header {
            display: flex;
            align-items: center;
            padding: 20px 15px;
            background: linear-gradient(135deg, #FF6B6B 0%, #FF9800 100%);
            border-radius: 20px;
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .btn-volver {
            background: white;
            color: #FF6B6B;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 15px;
            font-size: 32px;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }

        .btn-volver:active {
            transform: scale(0.9);
        }

        .carrito-titulo {
            flex: 1;
            color: white;
            font-size: 32px;
            font-weight: bold;
        }

        .carrito-items-container {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 10px 0;
        }

        .carrito-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .carrito-item-emoji {
            font-size: 50px;
            flex-shrink: 0;
        }

        .carrito-item-info {
            flex: 1;
        }

        .carrito-item-nombre {
            font-size: 24px;
            font-weight: bold;
            color: #2C3E50;
            margin-bottom: 5px;
        }

        .carrito-item-precio {
            font-size: 28px;
            color: #FF6B6B;
            font-weight: bold;
        }

        .btn-eliminar-item {
            background: #FF1744;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 10px;
            font-size: 24px;
            flex-shrink: 0;
            touch-action: manipulation;
        }

        .btn-eliminar-item:active {
            transform: scale(0.9);
        }

        .carrito-footer {
            flex-shrink: 0;
            padding-top: 15px;
            border-top: 3px solid #f0f0f0;
        }

        .carrito-total {
            background: linear-gradient(135deg, #FFD93D 0%, #FF9800 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .total-label {
            font-size: 32px;
            color: white;
            font-weight: bold;
        }

        .total-monto {
            font-size: 48px;
            color: white;
            font-weight: bold;
        }

        .btn-confirmar {
            width: 100%;
            padding: 30px;
            font-size: 36px;
            font-weight: bold;
            background: linear-gradient(135deg, #6BCF7F 0%, #4ECDC4 100%);
            color: white;
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(76, 205, 196, 0.4);
            font-family: 'Comic Sans MS', cursive;
            touch-action: manipulation;
        }

        .btn-confirmar:active {
            transform: scale(0.98);
        }

        .carrito-vacio {
            text-align: center;
            padding: 60px 20px;
        }

        .carrito-vacio-emoji {
            font-size: 100px;
            margin-bottom: 20px;
        }

        .carrito-vacio-texto {
            font-size: 28px;
            color: #999;
        }

        /* MENSAJE DE √âXITO */
        .mensaje-exito {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .mensaje-exito.show {
            display: flex;
        }

        .mensaje-exito-contenido {
            background: white;
            padding: 50px 30px;
            border-radius: 30px;
            text-align: center;
            max-width: 90%;
        }

        .mensaje-exito-emoji {
            font-size: 120px;
            margin-bottom: 20px;
            animation: bounce 0.5s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .mensaje-exito-texto {
            font-size: 36px;
            color: #2C3E50;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .mensaje-exito-total {
            font-size: 56px;
            color: #FF6B6B;
            font-weight: bold;
        }

        .btn-admin {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(44, 62, 80, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            z-index: 100;
            touch-action: manipulation;
        }

        /* ANIMACI√ìN AL AGREGAR */
        @keyframes agregado {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); background: #4ECDC4; }
            100% { transform: scale(1); }
        }

        .producto-card.agregado {
            animation: agregado 0.3s;
        }

        /* OCULTAR SCROLLBAR PERO MANTENER FUNCIONALIDAD */
        .productos-container::-webkit-scrollbar,
        .carrito-items-container::-webkit-scrollbar {
            display: none;
        }

        .productos-container,
        .carrito-items-container {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body>
    <!-- Bot√≥n Admin -->
    <button class="btn-admin" onclick="irAdmin()">‚öôÔ∏è</button>

    <!-- VISTA PRODUCTOS -->
    <div class="vista-productos" id="vistaProductos">
        <div class="header">
            <div class="logo-container" id="logoContainer">
                <div class="logo-placeholder">üçπ</div>
            </div>
            <h1>FRUTI TECH</h1>
        </div>

        <div class="productos-container" id="productosContainer">
            <!-- Productos se cargan aqu√≠ -->
        </div>

        <button class="btn-ver-carrito" onclick="mostrarCarrito()">
            üõí
            <span class="carrito-badge" id="carritoBadge">0</span>
        </button>
    </div>

    <!-- VISTA CARRITO -->
    <div class="vista-carrito" id="vistaCarrito">
        <div class="carrito-header">
            <button class="btn-volver" onclick="mostrarProductos()">‚Üê</button>
            <div class="carrito-titulo">MI PEDIDO</div>
        </div>

        <div class="carrito-items-container" id="carritoItemsContainer">
            <!-- Items del carrito -->
        </div>

        <div class="carrito-footer" id="carritoFooter">
                <div class="carrito-total">
                <div class="total-label">üí∞ TOTAL:</div>
                <div class="total-monto" id="totalMonto">Bs. 0.00</div>
            </div>
            <button class="btn-confirmar" onclick="confirmarPedido()">
                ‚úÖ CONFIRMAR PEDIDO
            </button>
        </div>
    </div>

    <!-- MENSAJE √âXITO -->
    <div class="mensaje-exito" id="mensajeExito">
            <div class="mensaje-exito-contenido">
            <div class="mensaje-exito-emoji">üéâ</div>
            <div class="mensaje-exito-texto">¬°PEDIDO LISTO!</div>
            <div class="mensaje-exito-total" id="mensajeTotal">Bs. 0.00</div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // Variables globales
        let vistaActual = 'productos';

        // Cargar al iniciar
        window.addEventListener('DOMContentLoaded', () => {
            cargarLogo();
            cargarProductosMobile();
            actualizarCarritoMobile();
        });

        function cargarProductosMobile() {
            cargarDatos();
            const container = document.getElementById('productosContainer');
            container.innerHTML = '';

            if (productos.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px;">
                        <div style="font-size: 80px; margin-bottom: 20px;">üì¶</div>
                        <div style="font-size: 24px; color: #999;">No hay productos disponibles</div>
                    </div>
                `;
                return;
            }

            productos.forEach(producto => {
                const card = document.createElement('div');
                card.className = 'producto-card';
                card.id = `producto-${producto.id}`;

                const imagenHTML = producto.imagen 
                    ? `<img src="${producto.imagen}" alt="${producto.nombre}">`
                    : `<div class="producto-emoji">${producto.emoji}</div>`;

                card.innerHTML = `
                    <div class="producto-imagen">
                        ${imagenHTML}
                    </div>
                    <div class="producto-info">
                        <div class="producto-nombre">${producto.nombre}</div>
                        <div class="producto-precio">Bs. ${producto.precio.toFixed(2)}</div>
                    </div>
                    <button class="btn-agregar" onclick="agregarAlCarritoMobile(${producto.id})">
                        ‚ûï AGREGAR
                    </button>
                `;

                container.appendChild(card);
            });
        }

        function agregarAlCarritoMobile(id) {
            const producto = productos.find(p => p.id === id);
            if (!producto) return;

            // Agregar al carrito
            carrito.push({...producto});
            guardarCarrito();
            actualizarCarritoMobile();

            // Animaci√≥n visual
            const card = document.getElementById(`producto-${id}`);
            card.classList.add('agregado');
            setTimeout(() => card.classList.remove('agregado'), 300);

            // Sonido
            reproducirSonido();

            // Vibraci√≥n
            if ('vibrate' in navigator) {
                navigator.vibrate(50);
            }
        }

        function actualizarCarritoMobile() {
            const badge = document.getElementById('carritoBadge');
            const container = document.getElementById('carritoItemsContainer');
            const footer = document.getElementById('carritoFooter');
            const totalMonto = document.getElementById('totalMonto');

            // Actualizar badge
            badge.textContent = carrito.length;

            if (carrito.length === 0) {
                container.innerHTML = `
                    <div class="carrito-vacio">
                        <div class="carrito-vacio-emoji">üõí</div>
                        <div class="carrito-vacio-texto">Tu carrito est√° vac√≠o</div>
                    </div>
                `;
                footer.style.display = 'none';
                return;
            }

            // Agrupar productos
            const productosAgrupados = {};
            carrito.forEach(item => {
                if (productosAgrupados[item.id]) {
                    productosAgrupados[item.id].cantidad++;
                } else {
                    productosAgrupados[item.id] = {...item, cantidad: 1};
                }
            });

            // Mostrar items
            container.innerHTML = '';
            let total = 0;

            Object.values(productosAgrupados).forEach((item, index) => {
                const subtotal = item.precio * item.cantidad;
                total += subtotal;

                const div = document.createElement('div');
                div.className = 'carrito-item';
                div.innerHTML = `
                    <div class="carrito-item-emoji">${item.emoji}</div>
                    <div class="carrito-item-info">
                        <div class="carrito-item-nombre">${item.nombre} x${item.cantidad}</div>
                        <div class="carrito-item-precio">Bs. ${subtotal.toFixed(2)}</div>
                    </div>
                    <button class="btn-eliminar-item" onclick="eliminarDelCarritoMobile(${item.id})">
                        üóëÔ∏è
                    </button>
                `;
                container.appendChild(div);
            });

            totalMonto.textContent = `Bs. ${total.toFixed(2)}`;
            footer.style.display = 'block';
        }

        function eliminarDelCarritoMobile(id) {
            const index = carrito.findIndex(item => item.id === id);
            if (index !== -1) {
                carrito.splice(index, 1);
                guardarCarrito();
                actualizarCarritoMobile();
            }
        }

        function mostrarCarrito() {
            document.getElementById('vistaProductos').style.display = 'none';
            document.getElementById('vistaCarrito').classList.add('activa');
            vistaActual = 'carrito';
        }

        function mostrarProductos() {
            document.getElementById('vistaProductos').style.display = 'flex';
            document.getElementById('vistaCarrito').classList.remove('activa');
            vistaActual = 'productos';
        }

        function confirmarPedido() {
            if (carrito.length === 0) return;

            const total = carrito.reduce((sum, item) => sum + item.precio, 0);

            // Guardar en historial
            pedidosHistorial.push({
                fecha: new Date().toISOString(),
                items: [...carrito],
                total: total
            });
            guardarHistorial();

            // Mostrar mensaje
            document.getElementById('mensajeTotal').textContent = `Bs. ${total.toFixed(2)}`;
            document.getElementById('mensajeExito').classList.add('show');

            // Sonido de √©xito
            reproducirSonidoExito();

            // Vibraci√≥n
            if ('vibrate' in navigator) {
                navigator.vibrate([100, 50, 100, 50, 200]);
            }

            // Limpiar y volver
            setTimeout(() => {
                carrito = [];
                guardarCarrito();
                actualizarCarritoMobile();
                document.getElementById('mensajeExito').classList.remove('show');
                mostrarProductos();
            }, 3000);
        }

        function irAdmin() {
            window.location.href = 'admin.html';
        }

        // Prevenir zoom con doble tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
        <!-- Registrar Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registrado:', registration);
                    })
                    .catch(error => {
                        console.log('‚ùå Error al registrar Service Worker:', error);
                    });
            });
        }

        // Detectar si es PWA instalada
        window.addEventListener('DOMContentLoaded', () => {
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('üì± Ejecutando como PWA');
                document.body.classList.add('pwa-mode');
            }
        });

        // Prompt de instalaci√≥n
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            mostrarBotonInstalar();
        });

        function mostrarBotonInstalar() {
            // Crear bot√≥n de instalaci√≥n
            const btnInstalar = document.createElement('button');
            btnInstalar.textContent = 'üì≤ Instalar App';
            btnInstalar.style.cssText = `
                position: fixed;
                bottom: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #6BCF7F 0%, #4ECDC4 100%);
                color: white;
                border: none;
                padding: 15px 30px;
                border-radius: 25px;
                font-size: 18px;
                font-weight: bold;
                box-shadow: 0 5px 20px rgba(76, 205, 196, 0.5);
                z-index: 9999;
                cursor: pointer;
                font-family: 'Comic Sans MS', cursive;
            `;
            
            btnInstalar.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`Usuario ${outcome === 'accepted' ? 'acept√≥' : 'rechaz√≥'} la instalaci√≥n`);
                    deferredPrompt = null;
                    btnInstalar.remove();
                }
            });
            
            document.body.appendChild(btnInstalar);
            
            // Auto-ocultar despu√©s de 10 segundos
            setTimeout(() => {
                btnInstalar.style.opacity = '0';
                setTimeout(() => btnInstalar.remove(), 300);
            }, 10000);
        }

        window.addEventListener('appinstalled', () => {
            console.log('‚úÖ PWA instalada exitosamente');
            deferredPrompt = null;
        });
    </script>

</body>
</html>
